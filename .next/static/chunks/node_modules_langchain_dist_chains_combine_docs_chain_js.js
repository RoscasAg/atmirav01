"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk_N_E"] = self["webpackChunk_N_E"] || []).push([["node_modules_langchain_dist_chains_combine_docs_chain_js"],{

/***/ "./node_modules/langchain/dist/chains/combine_docs_chain.js":
/*!******************************************************************!*\
  !*** ./node_modules/langchain/dist/chains/combine_docs_chain.js ***!
  \******************************************************************/
/***/ (function(__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MapReduceDocumentsChain: function() { return /* binding */ MapReduceDocumentsChain; },\n/* harmony export */   RefineDocumentsChain: function() { return /* binding */ RefineDocumentsChain; },\n/* harmony export */   StuffDocumentsChain: function() { return /* binding */ StuffDocumentsChain; }\n/* harmony export */ });\n/* harmony import */ var _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @langchain/core/prompts */ \"./node_modules/@langchain/core/prompts.js\");\n/* harmony import */ var _base_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./base.js */ \"./node_modules/langchain/dist/chains/base.js\");\n/* harmony import */ var _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./llm_chain.js */ \"./node_modules/langchain/dist/chains/llm_chain.js\");\n\n\n\n/**\n * Chain that combines documents by stuffing into context.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */\nclass StuffDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"StuffDocumentsChain\";\n    }\n    get inputKeys() {\n        return [this.inputKey, ...this.llmChain.inputKeys].filter((key) => key !== this.documentVariableName);\n    }\n    get outputKeys() {\n        return this.llmChain.outputKeys;\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        this.llmChain = fields.llmChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n    }\n    /** @ignore */\n    _prepInputs(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        const texts = docs.map(({ pageContent }) => pageContent);\n        const text = texts.join(\"\\n\\n\");\n        return {\n            ...rest,\n            [this.documentVariableName]: text,\n        };\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        const result = await this.llmChain.call(this._prepInputs(values), runManager?.getChild(\"combine_documents\"));\n        return result;\n    }\n    _chainType() {\n        return \"stuff_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        return new StuffDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n        };\n    }\n}\n/**\n * Combine documents by mapping a chain over them, then combining results.\n * @augments BaseChain\n * @augments StuffDocumentsChainInput\n */\nclass MapReduceDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"MapReduceDocumentsChain\";\n    }\n    get inputKeys() {\n        return [this.inputKey, ...this.combineDocumentChain.inputKeys];\n    }\n    get outputKeys() {\n        return this.combineDocumentChain.outputKeys;\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"returnIntermediateSteps\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"maxTokens\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 3000\n        });\n        Object.defineProperty(this, \"maxIterations\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 10\n        });\n        Object.defineProperty(this, \"ensureMapStep\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        Object.defineProperty(this, \"combineDocumentChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        this.llmChain = fields.llmChain;\n        this.combineDocumentChain = fields.combineDocumentChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.ensureMapStep = fields.ensureMapStep ?? this.ensureMapStep;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.maxTokens = fields.maxTokens ?? this.maxTokens;\n        this.maxIterations = fields.maxIterations ?? this.maxIterations;\n        this.returnIntermediateSteps = fields.returnIntermediateSteps ?? false;\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        let currentDocs = docs;\n        let intermediateSteps = [];\n        // For each iteration, we'll use the `llmChain` to get a new result\n        for (let i = 0; i < this.maxIterations; i += 1) {\n            const inputs = currentDocs.map((d) => ({\n                [this.documentVariableName]: d.pageContent,\n                ...rest,\n            }));\n            const canSkipMapStep = i !== 0 || !this.ensureMapStep;\n            if (canSkipMapStep) {\n                // Calculate the total tokens required in the input\n                const formatted = await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({\n                    [this.combineDocumentChain.inputKey]: currentDocs,\n                    ...rest,\n                }));\n                const length = await this.combineDocumentChain.llmChain._getNumTokens(formatted);\n                const withinTokenLimit = length < this.maxTokens;\n                // If we can skip the map step, and we're within the token limit, we don't\n                // need to run the map step, so just break out of the loop.\n                if (withinTokenLimit) {\n                    break;\n                }\n            }\n            const results = await this.llmChain.apply(inputs, \n            // If we have a runManager, then we need to create a child for each input\n            // so that we can track the progress of each input.\n            runManager\n                ? Array.from({ length: inputs.length }, (_, i) => runManager.getChild(`map_${i + 1}`))\n                : undefined);\n            const { outputKey } = this.llmChain;\n            // If the flag is set, then concat that to the intermediate steps\n            if (this.returnIntermediateSteps) {\n                intermediateSteps = intermediateSteps.concat(results.map((r) => r[outputKey]));\n            }\n            currentDocs = results.map((r) => ({\n                pageContent: r[outputKey],\n                metadata: {},\n            }));\n        }\n        // Now, with the final result of all the inputs from the `llmChain`, we can\n        // run the `combineDocumentChain` over them.\n        const newInputs = {\n            [this.combineDocumentChain.inputKey]: currentDocs,\n            ...rest,\n        };\n        const result = await this.combineDocumentChain.call(newInputs, runManager?.getChild(\"combine_documents\"));\n        // Return the intermediate steps results if the flag is set\n        if (this.returnIntermediateSteps) {\n            return { ...result, intermediateSteps };\n        }\n        return result;\n    }\n    _chainType() {\n        return \"map_reduce_documents_chain\";\n    }\n    static async deserialize(data) {\n        if (!data.llm_chain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        if (!data.combine_document_chain) {\n            throw new Error(\"Missing combine_document_chain\");\n        }\n        return new MapReduceDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(data.llm_chain),\n            combineDocumentChain: await StuffDocumentsChain.deserialize(data.combine_document_chain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            combine_document_chain: this.combineDocumentChain.serialize(),\n        };\n    }\n}\n/**\n * Combine documents by doing a first pass and then refining on more documents.\n * @augments BaseChain\n * @augments RefineDocumentsChainInput\n */\nclass RefineDocumentsChain extends _base_js__WEBPACK_IMPORTED_MODULE_1__.BaseChain {\n    static lc_name() {\n        return \"RefineDocumentsChain\";\n    }\n    get defaultDocumentPrompt() {\n        return new _langchain_core_prompts__WEBPACK_IMPORTED_MODULE_0__.PromptTemplate({\n            inputVariables: [\"page_content\"],\n            template: \"{page_content}\",\n        });\n    }\n    get inputKeys() {\n        return [\n            ...new Set([\n                this.inputKey,\n                ...this.llmChain.inputKeys,\n                ...this.refineLLMChain.inputKeys,\n            ]),\n        ].filter((key) => key !== this.documentVariableName && key !== this.initialResponseName);\n    }\n    get outputKeys() {\n        return [this.outputKey];\n    }\n    constructor(fields) {\n        super(fields);\n        Object.defineProperty(this, \"llmChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"input_documents\"\n        });\n        Object.defineProperty(this, \"outputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"output_text\"\n        });\n        Object.defineProperty(this, \"documentVariableName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"context\"\n        });\n        Object.defineProperty(this, \"initialResponseName\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"existing_answer\"\n        });\n        Object.defineProperty(this, \"refineLLMChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"documentPrompt\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: this.defaultDocumentPrompt\n        });\n        this.llmChain = fields.llmChain;\n        this.refineLLMChain = fields.refineLLMChain;\n        this.documentVariableName =\n            fields.documentVariableName ?? this.documentVariableName;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.outputKey = fields.outputKey ?? this.outputKey;\n        this.documentPrompt = fields.documentPrompt ?? this.documentPrompt;\n        this.initialResponseName =\n            fields.initialResponseName ?? this.initialResponseName;\n    }\n    /** @ignore */\n    async _constructInitialInputs(doc, rest) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata,\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value) => {\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo,\n            }),\n        };\n        const inputs = { ...baseInputs, ...rest };\n        return inputs;\n    }\n    /** @ignore */\n    async _constructRefineInputs(doc, res) {\n        const baseInfo = {\n            page_content: doc.pageContent,\n            ...doc.metadata,\n        };\n        const documentInfo = {};\n        this.documentPrompt.inputVariables.forEach((value) => {\n            documentInfo[value] = baseInfo[value];\n        });\n        const baseInputs = {\n            [this.documentVariableName]: await this.documentPrompt.format({\n                ...documentInfo,\n            }),\n        };\n        const inputs = { [this.initialResponseName]: res, ...baseInputs };\n        return inputs;\n    }\n    /** @ignore */\n    async _call(values, runManager) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Document key ${this.inputKey} not found.`);\n        }\n        const { [this.inputKey]: docs, ...rest } = values;\n        const currentDocs = docs;\n        const initialInputs = await this._constructInitialInputs(currentDocs[0], rest);\n        let res = await this.llmChain.predict({ ...initialInputs }, runManager?.getChild(\"answer\"));\n        const refineSteps = [res];\n        for (let i = 1; i < currentDocs.length; i += 1) {\n            const refineInputs = await this._constructRefineInputs(currentDocs[i], res);\n            const inputs = { ...refineInputs, ...rest };\n            res = await this.refineLLMChain.predict({ ...inputs }, runManager?.getChild(\"refine\"));\n            refineSteps.push(res);\n        }\n        return { [this.outputKey]: res };\n    }\n    _chainType() {\n        return \"refine_documents_chain\";\n    }\n    static async deserialize(data) {\n        const SerializedLLMChain = data.llm_chain;\n        if (!SerializedLLMChain) {\n            throw new Error(\"Missing llm_chain\");\n        }\n        const SerializedRefineDocumentChain = data.refine_llm_chain;\n        if (!SerializedRefineDocumentChain) {\n            throw new Error(\"Missing refine_llm_chain\");\n        }\n        return new RefineDocumentsChain({\n            llmChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedLLMChain),\n            refineLLMChain: await _llm_chain_js__WEBPACK_IMPORTED_MODULE_2__.LLMChain.deserialize(SerializedRefineDocumentChain),\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            llm_chain: this.llmChain.serialize(),\n            refine_llm_chain: this.refineLLMChain.serialize(),\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9ub2RlX21vZHVsZXMvbGFuZ2NoYWluL2Rpc3QvY2hhaW5zL2NvbWJpbmVfZG9jc19jaGFpbi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBeUQ7QUFDbkI7QUFDSTtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sa0NBQWtDLCtDQUFTO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGVBQWU7QUFDM0Q7QUFDQSxnQkFBZ0IsaUNBQWlDO0FBQ2pELGtDQUFrQyxhQUFhO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG1EQUFRO0FBQ3BDLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNPLHNDQUFzQywrQ0FBUztBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGVBQWU7QUFDM0Q7QUFDQSxnQkFBZ0IsaUNBQWlDO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix3QkFBd0I7QUFDaEQ7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsdUJBQXVCLHVDQUF1QyxNQUFNO0FBQ25HO0FBQ0Esb0JBQW9CLFlBQVk7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG1EQUFRO0FBQ3BDO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDTyxtQ0FBbUMsK0NBQVM7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsbUVBQWM7QUFDakM7QUFDQSx3QkFBd0IsYUFBYTtBQUNyQyxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxlQUFlO0FBQzNEO0FBQ0EsZ0JBQWdCLGlDQUFpQztBQUNqRDtBQUNBO0FBQ0EsZ0RBQWdELGtCQUFrQjtBQUNsRTtBQUNBLHdCQUF3Qix3QkFBd0I7QUFDaEQ7QUFDQSw2QkFBNkI7QUFDN0Isc0RBQXNELFdBQVc7QUFDakU7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG1EQUFRO0FBQ3BDLGtDQUFrQyxtREFBUTtBQUMxQyxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL25vZGVfbW9kdWxlcy9sYW5nY2hhaW4vZGlzdC9jaGFpbnMvY29tYmluZV9kb2NzX2NoYWluLmpzPzZkZTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvbXB0VGVtcGxhdGUgfSBmcm9tIFwiQGxhbmdjaGFpbi9jb3JlL3Byb21wdHNcIjtcbmltcG9ydCB7IEJhc2VDaGFpbiB9IGZyb20gXCIuL2Jhc2UuanNcIjtcbmltcG9ydCB7IExMTUNoYWluIH0gZnJvbSBcIi4vbGxtX2NoYWluLmpzXCI7XG4vKipcbiAqIENoYWluIHRoYXQgY29tYmluZXMgZG9jdW1lbnRzIGJ5IHN0dWZmaW5nIGludG8gY29udGV4dC5cbiAqIEBhdWdtZW50cyBCYXNlQ2hhaW5cbiAqIEBhdWdtZW50cyBTdHVmZkRvY3VtZW50c0NoYWluSW5wdXRcbiAqL1xuZXhwb3J0IGNsYXNzIFN0dWZmRG9jdW1lbnRzQ2hhaW4gZXh0ZW5kcyBCYXNlQ2hhaW4ge1xuICAgIHN0YXRpYyBsY19uYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJTdHVmZkRvY3VtZW50c0NoYWluXCI7XG4gICAgfVxuICAgIGdldCBpbnB1dEtleXMoKSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5pbnB1dEtleSwgLi4udGhpcy5sbG1DaGFpbi5pbnB1dEtleXNdLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWUpO1xuICAgIH1cbiAgICBnZXQgb3V0cHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGxtQ2hhaW4ub3V0cHV0S2V5cztcbiAgICB9XG4gICAgY29uc3RydWN0b3IoZmllbGRzKSB7XG4gICAgICAgIHN1cGVyKGZpZWxkcyk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImxsbUNoYWluXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImlucHV0S2V5XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImlucHV0X2RvY3VtZW50c1wiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkb2N1bWVudFZhcmlhYmxlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJjb250ZXh0XCJcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGxtQ2hhaW4gPSBmaWVsZHMubGxtQ2hhaW47XG4gICAgICAgIHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPVxuICAgICAgICAgICAgZmllbGRzLmRvY3VtZW50VmFyaWFibGVOYW1lID8/IHRoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWU7XG4gICAgICAgIHRoaXMuaW5wdXRLZXkgPSBmaWVsZHMuaW5wdXRLZXkgPz8gdGhpcy5pbnB1dEtleTtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBfcHJlcElucHV0cyh2YWx1ZXMpIHtcbiAgICAgICAgaWYgKCEodGhpcy5pbnB1dEtleSBpbiB2YWx1ZXMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYERvY3VtZW50IGtleSAke3RoaXMuaW5wdXRLZXl9IG5vdCBmb3VuZC5gKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB7IFt0aGlzLmlucHV0S2V5XTogZG9jcywgLi4ucmVzdCB9ID0gdmFsdWVzO1xuICAgICAgICBjb25zdCB0ZXh0cyA9IGRvY3MubWFwKCh7IHBhZ2VDb250ZW50IH0pID0+IHBhZ2VDb250ZW50KTtcbiAgICAgICAgY29uc3QgdGV4dCA9IHRleHRzLmpvaW4oXCJcXG5cXG5cIik7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiB0ZXh0LFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jYWxsKHZhbHVlcywgcnVuTWFuYWdlcikge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmxsbUNoYWluLmNhbGwodGhpcy5fcHJlcElucHV0cyh2YWx1ZXMpLCBydW5NYW5hZ2VyPy5nZXRDaGlsZChcImNvbWJpbmVfZG9jdW1lbnRzXCIpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgX2NoYWluVHlwZSgpIHtcbiAgICAgICAgcmV0dXJuIFwic3R1ZmZfZG9jdW1lbnRzX2NoYWluXCI7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBkZXNlcmlhbGl6ZShkYXRhKSB7XG4gICAgICAgIGlmICghZGF0YS5sbG1fY2hhaW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgbGxtX2NoYWluXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgU3R1ZmZEb2N1bWVudHNDaGFpbih7XG4gICAgICAgICAgICBsbG1DaGFpbjogYXdhaXQgTExNQ2hhaW4uZGVzZXJpYWxpemUoZGF0YS5sbG1fY2hhaW4pLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc2VyaWFsaXplKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgX3R5cGU6IHRoaXMuX2NoYWluVHlwZSgpLFxuICAgICAgICAgICAgbGxtX2NoYWluOiB0aGlzLmxsbUNoYWluLnNlcmlhbGl6ZSgpLFxuICAgICAgICB9O1xuICAgIH1cbn1cbi8qKlxuICogQ29tYmluZSBkb2N1bWVudHMgYnkgbWFwcGluZyBhIGNoYWluIG92ZXIgdGhlbSwgdGhlbiBjb21iaW5pbmcgcmVzdWx0cy5cbiAqIEBhdWdtZW50cyBCYXNlQ2hhaW5cbiAqIEBhdWdtZW50cyBTdHVmZkRvY3VtZW50c0NoYWluSW5wdXRcbiAqL1xuZXhwb3J0IGNsYXNzIE1hcFJlZHVjZURvY3VtZW50c0NoYWluIGV4dGVuZHMgQmFzZUNoYWluIHtcbiAgICBzdGF0aWMgbGNfbmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIFwiTWFwUmVkdWNlRG9jdW1lbnRzQ2hhaW5cIjtcbiAgICB9XG4gICAgZ2V0IGlucHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLmlucHV0S2V5LCAuLi50aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmlucHV0S2V5c107XG4gICAgfVxuICAgIGdldCBvdXRwdXRLZXlzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5vdXRwdXRLZXlzO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibGxtQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5wdXRLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiaW5wdXRfZG9jdW1lbnRzXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50VmFyaWFibGVOYW1lXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBcImNvbnRleHRcIlxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwicmV0dXJuSW50ZXJtZWRpYXRlU3RlcHNcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJtYXhUb2tlbnNcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IDMwMDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm1heEl0ZXJhdGlvbnNcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IDEwXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJlbnN1cmVNYXBTdGVwXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiY29tYmluZURvY3VtZW50Q2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sbG1DaGFpbiA9IGZpZWxkcy5sbG1DaGFpbjtcbiAgICAgICAgdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbiA9IGZpZWxkcy5jb21iaW5lRG9jdW1lbnRDaGFpbjtcbiAgICAgICAgdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA9XG4gICAgICAgICAgICBmaWVsZHMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPz8gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZTtcbiAgICAgICAgdGhpcy5lbnN1cmVNYXBTdGVwID0gZmllbGRzLmVuc3VyZU1hcFN0ZXAgPz8gdGhpcy5lbnN1cmVNYXBTdGVwO1xuICAgICAgICB0aGlzLmlucHV0S2V5ID0gZmllbGRzLmlucHV0S2V5ID8/IHRoaXMuaW5wdXRLZXk7XG4gICAgICAgIHRoaXMubWF4VG9rZW5zID0gZmllbGRzLm1heFRva2VucyA/PyB0aGlzLm1heFRva2VucztcbiAgICAgICAgdGhpcy5tYXhJdGVyYXRpb25zID0gZmllbGRzLm1heEl0ZXJhdGlvbnMgPz8gdGhpcy5tYXhJdGVyYXRpb25zO1xuICAgICAgICB0aGlzLnJldHVybkludGVybWVkaWF0ZVN0ZXBzID0gZmllbGRzLnJldHVybkludGVybWVkaWF0ZVN0ZXBzID8/IGZhbHNlO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jYWxsKHZhbHVlcywgcnVuTWFuYWdlcikge1xuICAgICAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRG9jdW1lbnQga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgW3RoaXMuaW5wdXRLZXldOiBkb2NzLCAuLi5yZXN0IH0gPSB2YWx1ZXM7XG4gICAgICAgIGxldCBjdXJyZW50RG9jcyA9IGRvY3M7XG4gICAgICAgIGxldCBpbnRlcm1lZGlhdGVTdGVwcyA9IFtdO1xuICAgICAgICAvLyBGb3IgZWFjaCBpdGVyYXRpb24sIHdlJ2xsIHVzZSB0aGUgYGxsbUNoYWluYCB0byBnZXQgYSBuZXcgcmVzdWx0XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5tYXhJdGVyYXRpb25zOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9IGN1cnJlbnREb2NzLm1hcCgoZCkgPT4gKHtcbiAgICAgICAgICAgICAgICBbdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZV06IGQucGFnZUNvbnRlbnQsXG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGNvbnN0IGNhblNraXBNYXBTdGVwID0gaSAhPT0gMCB8fCAhdGhpcy5lbnN1cmVNYXBTdGVwO1xuICAgICAgICAgICAgaWYgKGNhblNraXBNYXBTdGVwKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB0b3RhbCB0b2tlbnMgcmVxdWlyZWQgaW4gdGhlIGlucHV0XG4gICAgICAgICAgICAgICAgY29uc3QgZm9ybWF0dGVkID0gYXdhaXQgdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5sbG1DaGFpbi5wcm9tcHQuZm9ybWF0KHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uX3ByZXBJbnB1dHMoe1xuICAgICAgICAgICAgICAgICAgICBbdGhpcy5jb21iaW5lRG9jdW1lbnRDaGFpbi5pbnB1dEtleV06IGN1cnJlbnREb2NzLFxuICAgICAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsZW5ndGggPSBhd2FpdCB0aGlzLmNvbWJpbmVEb2N1bWVudENoYWluLmxsbUNoYWluLl9nZXROdW1Ub2tlbnMoZm9ybWF0dGVkKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3aXRoaW5Ub2tlbkxpbWl0ID0gbGVuZ3RoIDwgdGhpcy5tYXhUb2tlbnM7XG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgY2FuIHNraXAgdGhlIG1hcCBzdGVwLCBhbmQgd2UncmUgd2l0aGluIHRoZSB0b2tlbiBsaW1pdCwgd2UgZG9uJ3RcbiAgICAgICAgICAgICAgICAvLyBuZWVkIHRvIHJ1biB0aGUgbWFwIHN0ZXAsIHNvIGp1c3QgYnJlYWsgb3V0IG9mIHRoZSBsb29wLlxuICAgICAgICAgICAgICAgIGlmICh3aXRoaW5Ub2tlbkxpbWl0KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLmxsbUNoYWluLmFwcGx5KGlucHV0cywgXG4gICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgcnVuTWFuYWdlciwgdGhlbiB3ZSBuZWVkIHRvIGNyZWF0ZSBhIGNoaWxkIGZvciBlYWNoIGlucHV0XG4gICAgICAgICAgICAvLyBzbyB0aGF0IHdlIGNhbiB0cmFjayB0aGUgcHJvZ3Jlc3Mgb2YgZWFjaCBpbnB1dC5cbiAgICAgICAgICAgIHJ1bk1hbmFnZXJcbiAgICAgICAgICAgICAgICA/IEFycmF5LmZyb20oeyBsZW5ndGg6IGlucHV0cy5sZW5ndGggfSwgKF8sIGkpID0+IHJ1bk1hbmFnZXIuZ2V0Q2hpbGQoYG1hcF8ke2kgKyAxfWApKVxuICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIGNvbnN0IHsgb3V0cHV0S2V5IH0gPSB0aGlzLmxsbUNoYWluO1xuICAgICAgICAgICAgLy8gSWYgdGhlIGZsYWcgaXMgc2V0LCB0aGVuIGNvbmNhdCB0aGF0IHRvIHRoZSBpbnRlcm1lZGlhdGUgc3RlcHNcbiAgICAgICAgICAgIGlmICh0aGlzLnJldHVybkludGVybWVkaWF0ZVN0ZXBzKSB7XG4gICAgICAgICAgICAgICAgaW50ZXJtZWRpYXRlU3RlcHMgPSBpbnRlcm1lZGlhdGVTdGVwcy5jb25jYXQocmVzdWx0cy5tYXAoKHIpID0+IHJbb3V0cHV0S2V5XSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3VycmVudERvY3MgPSByZXN1bHRzLm1hcCgocikgPT4gKHtcbiAgICAgICAgICAgICAgICBwYWdlQ29udGVudDogcltvdXRwdXRLZXldLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiB7fSxcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3csIHdpdGggdGhlIGZpbmFsIHJlc3VsdCBvZiBhbGwgdGhlIGlucHV0cyBmcm9tIHRoZSBgbGxtQ2hhaW5gLCB3ZSBjYW5cbiAgICAgICAgLy8gcnVuIHRoZSBgY29tYmluZURvY3VtZW50Q2hhaW5gIG92ZXIgdGhlbS5cbiAgICAgICAgY29uc3QgbmV3SW5wdXRzID0ge1xuICAgICAgICAgICAgW3RoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uaW5wdXRLZXldOiBjdXJyZW50RG9jcyxcbiAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uY2FsbChuZXdJbnB1dHMsIHJ1bk1hbmFnZXI/LmdldENoaWxkKFwiY29tYmluZV9kb2N1bWVudHNcIikpO1xuICAgICAgICAvLyBSZXR1cm4gdGhlIGludGVybWVkaWF0ZSBzdGVwcyByZXN1bHRzIGlmIHRoZSBmbGFnIGlzIHNldFxuICAgICAgICBpZiAodGhpcy5yZXR1cm5JbnRlcm1lZGlhdGVTdGVwcykge1xuICAgICAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBpbnRlcm1lZGlhdGVTdGVwcyB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIF9jaGFpblR5cGUoKSB7XG4gICAgICAgIHJldHVybiBcIm1hcF9yZWR1Y2VfZG9jdW1lbnRzX2NoYWluXCI7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBkZXNlcmlhbGl6ZShkYXRhKSB7XG4gICAgICAgIGlmICghZGF0YS5sbG1fY2hhaW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgbGxtX2NoYWluXCIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YS5jb21iaW5lX2RvY3VtZW50X2NoYWluKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIGNvbWJpbmVfZG9jdW1lbnRfY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBNYXBSZWR1Y2VEb2N1bWVudHNDaGFpbih7XG4gICAgICAgICAgICBsbG1DaGFpbjogYXdhaXQgTExNQ2hhaW4uZGVzZXJpYWxpemUoZGF0YS5sbG1fY2hhaW4pLFxuICAgICAgICAgICAgY29tYmluZURvY3VtZW50Q2hhaW46IGF3YWl0IFN0dWZmRG9jdW1lbnRzQ2hhaW4uZGVzZXJpYWxpemUoZGF0YS5jb21iaW5lX2RvY3VtZW50X2NoYWluKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlcmlhbGl6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF90eXBlOiB0aGlzLl9jaGFpblR5cGUoKSxcbiAgICAgICAgICAgIGxsbV9jaGFpbjogdGhpcy5sbG1DaGFpbi5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgIGNvbWJpbmVfZG9jdW1lbnRfY2hhaW46IHRoaXMuY29tYmluZURvY3VtZW50Q2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuLyoqXG4gKiBDb21iaW5lIGRvY3VtZW50cyBieSBkb2luZyBhIGZpcnN0IHBhc3MgYW5kIHRoZW4gcmVmaW5pbmcgb24gbW9yZSBkb2N1bWVudHMuXG4gKiBAYXVnbWVudHMgQmFzZUNoYWluXG4gKiBAYXVnbWVudHMgUmVmaW5lRG9jdW1lbnRzQ2hhaW5JbnB1dFxuICovXG5leHBvcnQgY2xhc3MgUmVmaW5lRG9jdW1lbnRzQ2hhaW4gZXh0ZW5kcyBCYXNlQ2hhaW4ge1xuICAgIHN0YXRpYyBsY19uYW1lKCkge1xuICAgICAgICByZXR1cm4gXCJSZWZpbmVEb2N1bWVudHNDaGFpblwiO1xuICAgIH1cbiAgICBnZXQgZGVmYXVsdERvY3VtZW50UHJvbXB0KCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21wdFRlbXBsYXRlKHtcbiAgICAgICAgICAgIGlucHV0VmFyaWFibGVzOiBbXCJwYWdlX2NvbnRlbnRcIl0sXG4gICAgICAgICAgICB0ZW1wbGF0ZTogXCJ7cGFnZV9jb250ZW50fVwiLFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGlucHV0S2V5cygpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIC4uLm5ldyBTZXQoW1xuICAgICAgICAgICAgICAgIHRoaXMuaW5wdXRLZXksXG4gICAgICAgICAgICAgICAgLi4udGhpcy5sbG1DaGFpbi5pbnB1dEtleXMsXG4gICAgICAgICAgICAgICAgLi4udGhpcy5yZWZpbmVMTE1DaGFpbi5pbnB1dEtleXMsXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgXS5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSB0aGlzLmRvY3VtZW50VmFyaWFibGVOYW1lICYmIGtleSAhPT0gdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lKTtcbiAgICB9XG4gICAgZ2V0IG91dHB1dEtleXMoKSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5vdXRwdXRLZXldO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihmaWVsZHMpIHtcbiAgICAgICAgc3VwZXIoZmllbGRzKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwibGxtQ2hhaW5cIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IHZvaWQgMFxuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsIFwiaW5wdXRLZXlcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiaW5wdXRfZG9jdW1lbnRzXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcIm91dHB1dEtleVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJvdXRwdXRfdGV4dFwiXG4gICAgICAgIH0pO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgXCJkb2N1bWVudFZhcmlhYmxlTmFtZVwiLCB7XG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICB2YWx1ZTogXCJjb250ZXh0XCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImluaXRpYWxSZXNwb25zZU5hbWVcIiwge1xuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgICAgdmFsdWU6IFwiZXhpc3RpbmdfYW5zd2VyXCJcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcInJlZmluZUxMTUNoYWluXCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB2b2lkIDBcbiAgICAgICAgfSk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCBcImRvY3VtZW50UHJvbXB0XCIsIHtcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHZhbHVlOiB0aGlzLmRlZmF1bHREb2N1bWVudFByb21wdFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sbG1DaGFpbiA9IGZpZWxkcy5sbG1DaGFpbjtcbiAgICAgICAgdGhpcy5yZWZpbmVMTE1DaGFpbiA9IGZpZWxkcy5yZWZpbmVMTE1DaGFpbjtcbiAgICAgICAgdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZSA9XG4gICAgICAgICAgICBmaWVsZHMuZG9jdW1lbnRWYXJpYWJsZU5hbWUgPz8gdGhpcy5kb2N1bWVudFZhcmlhYmxlTmFtZTtcbiAgICAgICAgdGhpcy5pbnB1dEtleSA9IGZpZWxkcy5pbnB1dEtleSA/PyB0aGlzLmlucHV0S2V5O1xuICAgICAgICB0aGlzLm91dHB1dEtleSA9IGZpZWxkcy5vdXRwdXRLZXkgPz8gdGhpcy5vdXRwdXRLZXk7XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQgPSBmaWVsZHMuZG9jdW1lbnRQcm9tcHQgPz8gdGhpcy5kb2N1bWVudFByb21wdDtcbiAgICAgICAgdGhpcy5pbml0aWFsUmVzcG9uc2VOYW1lID1cbiAgICAgICAgICAgIGZpZWxkcy5pbml0aWFsUmVzcG9uc2VOYW1lID8/IHRoaXMuaW5pdGlhbFJlc3BvbnNlTmFtZTtcbiAgICB9XG4gICAgLyoqIEBpZ25vcmUgKi9cbiAgICBhc3luYyBfY29uc3RydWN0SW5pdGlhbElucHV0cyhkb2MsIHJlc3QpIHtcbiAgICAgICAgY29uc3QgYmFzZUluZm8gPSB7XG4gICAgICAgICAgICBwYWdlX2NvbnRlbnQ6IGRvYy5wYWdlQ29udGVudCxcbiAgICAgICAgICAgIC4uLmRvYy5tZXRhZGF0YSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJbmZvID0ge307XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQuaW5wdXRWYXJpYWJsZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50SW5mb1t2YWx1ZV0gPSBiYXNlSW5mb1t2YWx1ZV07XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBiYXNlSW5wdXRzID0ge1xuICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiBhd2FpdCB0aGlzLmRvY3VtZW50UHJvbXB0LmZvcm1hdCh7XG4gICAgICAgICAgICAgICAgLi4uZG9jdW1lbnRJbmZvLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IHsgLi4uYmFzZUlucHV0cywgLi4ucmVzdCB9O1xuICAgICAgICByZXR1cm4gaW5wdXRzO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jb25zdHJ1Y3RSZWZpbmVJbnB1dHMoZG9jLCByZXMpIHtcbiAgICAgICAgY29uc3QgYmFzZUluZm8gPSB7XG4gICAgICAgICAgICBwYWdlX2NvbnRlbnQ6IGRvYy5wYWdlQ29udGVudCxcbiAgICAgICAgICAgIC4uLmRvYy5tZXRhZGF0YSxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJbmZvID0ge307XG4gICAgICAgIHRoaXMuZG9jdW1lbnRQcm9tcHQuaW5wdXRWYXJpYWJsZXMuZm9yRWFjaCgodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGRvY3VtZW50SW5mb1t2YWx1ZV0gPSBiYXNlSW5mb1t2YWx1ZV07XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBiYXNlSW5wdXRzID0ge1xuICAgICAgICAgICAgW3RoaXMuZG9jdW1lbnRWYXJpYWJsZU5hbWVdOiBhd2FpdCB0aGlzLmRvY3VtZW50UHJvbXB0LmZvcm1hdCh7XG4gICAgICAgICAgICAgICAgLi4uZG9jdW1lbnRJbmZvLFxuICAgICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGlucHV0cyA9IHsgW3RoaXMuaW5pdGlhbFJlc3BvbnNlTmFtZV06IHJlcywgLi4uYmFzZUlucHV0cyB9O1xuICAgICAgICByZXR1cm4gaW5wdXRzO1xuICAgIH1cbiAgICAvKiogQGlnbm9yZSAqL1xuICAgIGFzeW5jIF9jYWxsKHZhbHVlcywgcnVuTWFuYWdlcikge1xuICAgICAgICBpZiAoISh0aGlzLmlucHV0S2V5IGluIHZhbHVlcykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRG9jdW1lbnQga2V5ICR7dGhpcy5pbnB1dEtleX0gbm90IGZvdW5kLmApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgW3RoaXMuaW5wdXRLZXldOiBkb2NzLCAuLi5yZXN0IH0gPSB2YWx1ZXM7XG4gICAgICAgIGNvbnN0IGN1cnJlbnREb2NzID0gZG9jcztcbiAgICAgICAgY29uc3QgaW5pdGlhbElucHV0cyA9IGF3YWl0IHRoaXMuX2NvbnN0cnVjdEluaXRpYWxJbnB1dHMoY3VycmVudERvY3NbMF0sIHJlc3QpO1xuICAgICAgICBsZXQgcmVzID0gYXdhaXQgdGhpcy5sbG1DaGFpbi5wcmVkaWN0KHsgLi4uaW5pdGlhbElucHV0cyB9LCBydW5NYW5hZ2VyPy5nZXRDaGlsZChcImFuc3dlclwiKSk7XG4gICAgICAgIGNvbnN0IHJlZmluZVN0ZXBzID0gW3Jlc107XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgY3VycmVudERvY3MubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlZmluZUlucHV0cyA9IGF3YWl0IHRoaXMuX2NvbnN0cnVjdFJlZmluZUlucHV0cyhjdXJyZW50RG9jc1tpXSwgcmVzKTtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0cyA9IHsgLi4ucmVmaW5lSW5wdXRzLCAuLi5yZXN0IH07XG4gICAgICAgICAgICByZXMgPSBhd2FpdCB0aGlzLnJlZmluZUxMTUNoYWluLnByZWRpY3QoeyAuLi5pbnB1dHMgfSwgcnVuTWFuYWdlcj8uZ2V0Q2hpbGQoXCJyZWZpbmVcIikpO1xuICAgICAgICAgICAgcmVmaW5lU3RlcHMucHVzaChyZXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7IFt0aGlzLm91dHB1dEtleV06IHJlcyB9O1xuICAgIH1cbiAgICBfY2hhaW5UeXBlKCkge1xuICAgICAgICByZXR1cm4gXCJyZWZpbmVfZG9jdW1lbnRzX2NoYWluXCI7XG4gICAgfVxuICAgIHN0YXRpYyBhc3luYyBkZXNlcmlhbGl6ZShkYXRhKSB7XG4gICAgICAgIGNvbnN0IFNlcmlhbGl6ZWRMTE1DaGFpbiA9IGRhdGEubGxtX2NoYWluO1xuICAgICAgICBpZiAoIVNlcmlhbGl6ZWRMTE1DaGFpbikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBsbG1fY2hhaW5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgU2VyaWFsaXplZFJlZmluZURvY3VtZW50Q2hhaW4gPSBkYXRhLnJlZmluZV9sbG1fY2hhaW47XG4gICAgICAgIGlmICghU2VyaWFsaXplZFJlZmluZURvY3VtZW50Q2hhaW4pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgcmVmaW5lX2xsbV9jaGFpblwiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJlZmluZURvY3VtZW50c0NoYWluKHtcbiAgICAgICAgICAgIGxsbUNoYWluOiBhd2FpdCBMTE1DaGFpbi5kZXNlcmlhbGl6ZShTZXJpYWxpemVkTExNQ2hhaW4pLFxuICAgICAgICAgICAgcmVmaW5lTExNQ2hhaW46IGF3YWl0IExMTUNoYWluLmRlc2VyaWFsaXplKFNlcmlhbGl6ZWRSZWZpbmVEb2N1bWVudENoYWluKSxcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlcmlhbGl6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF90eXBlOiB0aGlzLl9jaGFpblR5cGUoKSxcbiAgICAgICAgICAgIGxsbV9jaGFpbjogdGhpcy5sbG1DaGFpbi5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgIHJlZmluZV9sbG1fY2hhaW46IHRoaXMucmVmaW5lTExNQ2hhaW4uc2VyaWFsaXplKCksXG4gICAgICAgIH07XG4gICAgfVxufVxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./node_modules/langchain/dist/chains/combine_docs_chain.js\n"));

/***/ })

}]);